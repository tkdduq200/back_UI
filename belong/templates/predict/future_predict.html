{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

    <h2>1인 고령가구 고독사 장기 예측 (2026~2075, 5년 단위 Bar Chart)</h2>
    <hr>

    <form method="POST">
        <label for="gu">자치구 선택:</label>
        <select name="gu" class="form-control" style="max-width: 300px;">
            {% for gu in gu_list %}
            <option value="{{ gu }}" {% if gu == selected_gu %}selected{% endif %}>{{ gu }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary mt-2">조회</button>
    </form>

    {% if records %}
    <h4 class="mt-4">{{ selected_gu }} (2026~2075, 5년 단위 평균)</h4>
    
    <canvas id="futureBarChart" width="600" height="300"></canvas>
    {% endif %}

</div>
{% endblock %}

{% block script %}
{{ super() }}
<script>
    const yearRanges = JSON.parse('{{ year_ranges | tojson | safe }}');
    const binnedValues = JSON.parse('{{ binned_values | tojson | safe }}');

    if (yearRanges.length > 0 && binnedValues.length > 0) {
        const ctx = document.getElementById("futureBarChart").getContext("2d");

        new Chart(ctx, {
            type: "bar",
            data: {
                labels: yearRanges,
                datasets: [{
                    label: "5년 평균 고독사 위험",
                    data: binnedValues,
                    backgroundColor: "rgba(54, 162, 235, 0.5)",
                    borderColor: "rgba(54, 162, 235, 1)",
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
</script>
{% endblock %}
